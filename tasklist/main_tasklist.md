# メインタスクリスト

## 最終更新: 2025-09-21 16:00

## 🎯 プロジェクト目標
ブラウザでプレイ可能なダンジョン運営ゲームの開発・改善
- **勝利条件**: なし（より大きなダンジョンを作り上げること）
- **敗北条件**: ダンジョンコアが破壊されること

---

## ✅ 完了済みタスク

### Phase 1: 基本実装 [完了]
- [x] プロジェクト構造の作成
  - index.html作成
  - styles.css作成
  - jsフォルダ構造作成
- [x] タイトル画面実装
  - はじめからボタン
  - 続きからボタン
  - タイトルアニメーション
- [x] ゲーム画面基本レイアウト
  - ヘッダー（ステータス表示）
  - ダンジョンビュー（Canvas）
  - コントロールパネル（タブ切り替え）
  - 活動ログ
- [x] ゲームロジック実装
  - GameManagerクラス
  - ゲームループ（100ms間隔）
  - DP管理システム
- [x] ダンジョン管理システム
  - DungeonDataクラス
  - Floorクラス
  - グリッドベースのマップ（10x10）
- [x] エンティティシステム
  - Monster/Trap/Treasureクラス
  - Adventurerクラス
  - 配置システム
- [x] セーブ/ロード機能
  - LocalStorage使用
  - JSONシリアライズ
- [x] GitHubリポジトリ設定
  - 初期化＆コミット
  - リモート設定＆プッシュ

---

## 📋 未実装タスク（優先度順）

### Phase 1.5: コアゲームメカニクス追加 [緊急実装]

#### タスク1.5.1: 時間システム実装
**重要度: 最高**
**詳細:**
- [ ] ゲーム内時間の実装
  - 現実10分 = ゲーム内1日の変換
  - 時間表示UI（Day X, 時刻表示）
  - 日数カウンター
- [ ] 日次収入システム
  - 1日の開始時にDP収入
  - ダンジョン規模に応じた収入計算
  - 収入通知表示
- [ ] 日次レポート機能
  - 1日の終わりに収支表示
  - 冒険者襲来数の表示
  - DP収入/支出の内訳
- **実装ファイル:** js/game.js（新規TimeManagerクラス）
- **依存:** なし

#### タスク1.5.2: ダンジョンコアシステム
**重要度: 最高**
**詳細:**
- [ ] ダンジョンコアエンティティ追加
  - 特別なタイル/オブジェクトとして実装
  - 1Fの特定位置に配置（移動不可）
  - HP設定（破壊可能）
- [ ] 敗北条件実装
  - 冒険者がコアに到達で敗北
  - コアHP0で敗北
  - ゲームオーバー画面表示
- [ ] 敗北時リトライ機能
  - その日の開始時点に戻る
  - 前日終了時のセーブデータから復元
- **実装ファイル:** js/entities.js, js/game.js
- **依存:** タスク1.5.1

#### タスク1.5.3: オートセーブシステム
**重要度: 最高**
**詳細:**
- [ ] 日次オートセーブ
  - 1日の終了時に自動保存
  - 別スロットに保存（dailySave）
- [ ] セーブデータ管理改善
  - 複数セーブスロット対応
  - セーブデータのバージョニング
- **実装ファイル:** js/game.js
- **依存:** タスク1.5.1

#### タスク1.5.4: 冒険者襲来システム
**重要度: 高**
**詳細:**
- [ ] 定期襲来イベント
  - 時間経過で冒険者襲来頻度増加
  - 日数に応じた冒険者強化
  - ウェーブ形式の実装検討
- [ ] 襲来予告システム
  - 次の襲来までの時間表示
  - 襲来規模の予告
- **実装ファイル:** js/game.js, js/entities.js
- **依存:** タスク1.5.1

### Phase 2: ゲームプレイ改善 [未着手]

#### タスク2.1: 戦闘システムの完全実装
**重要度: 高**
**詳細:**
- [ ] 冒険者とモンスターの実際の戦闘処理
  - 位置：js/entities.js のAdventurerクラスに戦闘ロジック追加
  - 冒険者がモンスターと同じタイルに到達したら戦闘開始
  - ターン制バトル実装（攻撃→防御計算→ダメージ適用）
  - 戦闘アニメーション（ダメージ数値表示）
- [ ] 戦闘ログの詳細表示
  - ダメージ量の表示
  - 戦闘結果の通知
- **実装ファイル:** js/entities.js, js/game.js
- **依存:** なし

#### タスク2.2: 冒険者AI改善
**重要度: 高**
**詳細:**
- [ ] 経路探索アルゴリズム実装
  - A*アルゴリズムまたは簡易的なBFS
  - 壁を避けて移動
  - 宝箱を優先的に狙う
- [ ] 冒険者の行動パターン追加
  - 探索型（宝箱優先）
  - 突破型（階段直行）
  - 慎重型（罠回避）
- **実装ファイル:** js/entities.js (新規pathfinding.js作成も検討)
- **依存:** タスク2.1

#### タスク2.3: エンティティ管理改善
**重要度: 中**
**詳細:**
- [ ] エンティティ削除機能
  - 右クリックで削除
  - DP返却（50%返却など）
- [ ] エンティティ情報表示
  - ホバー時にステータス表示
  - 選択中のハイライト表示改善
- **実装ファイル:** js/ui.js, js/dungeon.js
- **依存:** なし

### Phase 3: UI/UX改善 [未着手]

#### タスク3.1: ビジュアル強化
**重要度: 中**
**詳細:**
- [ ] スプライト画像の導入
  - モンスターアイコン
  - 冒険者キャラクター
  - 罠・宝箱のビジュアル
- [ ] パーティクルエフェクト
  - 戦闘エフェクト
  - DP獲得エフェクト
- [ ] Canvas描画の最適化
- **実装ファイル:** js/ui.js, 新規assets/imagesフォルダ
- **依存:** なし

#### タスク3.2: サウンド実装
**重要度: 低**
**詳細:**
- [ ] BGM実装
  - タイトル画面BGM
  - ゲーム中BGM
- [ ] 効果音追加
  - 配置音
  - 戦闘音
  - DP獲得音
- [ ] 音量調整機能
- **実装ファイル:** 新規js/audio.js, assets/soundsフォルダ
- **依存:** なし

#### タスク3.3: レスポンシブ対応
**重要度: 低**
**詳細:**
- [ ] モバイル対応
  - タッチ操作対応
  - 画面サイズ調整
- [ ] タブレット最適化
- **実装ファイル:** styles.css, js/ui.js
- **依存:** なし

### Phase 4: ゲームバランス [未着手]

#### タスク4.1: 経済バランス調整
**重要度: 中**
**詳細:**
- [ ] DP獲得量の調整
- [ ] 施設コストの見直し
- [ ] 冒険者レベルスケーリング
- **実装ファイル:** js/game.js, js/entities.js
- **依存:** タスク2.1, 2.2

#### タスク4.2: 難易度システム
**重要度: 低**
**詳細:**
- [ ] 難易度選択（Easy/Normal/Hard）
- [ ] 時間経過による難易度上昇
- [ ] スコアランキング
- **実装ファイル:** js/game.js
- **依存:** タスク4.1

### Phase 5: 新機能追加 [未着手]

#### タスク5.1: スキルシステム
**重要度: 低**
**詳細:**
- [ ] ダンジョンマスタースキル
- [ ] モンスター強化
- [ ] 特殊罠の追加
- **実装ファイル:** 新規js/skills.js
- **依存:** Phase 2完了

#### タスク5.2: イベントシステム
**重要度: 低**
**詳細:**
- [ ] ランダムイベント
- [ ] ボス冒険者
- [ ] 報酬システム
- **実装ファイル:** 新規js/events.js
- **依存:** Phase 2完了

---

## 📝 作業時の注意事項

### コード修正時のルール
1. **必ず既存コードを読んでから修正**
   - Read toolで現在の実装確認
   - 既存のコーディングスタイルに合わせる

2. **テスト手順**
   - index.htmlをブラウザで開く
   - 基本動作確認（ゲーム開始、配置、セーブ/ロード）
   - コンソールエラー確認

3. **Git操作**
   - 機能単位でコミット
   - 意味のあるコミットメッセージ
   - 定期的にプッシュ

### ファイル更新時の記録
- このファイルの「最終更新」日時を更新
- 完了したタスクに[x]マーク
- 新規発見した問題は追加記載

### 記憶リセット時の復帰手順
1. tmp/project_status.mdで現状確認
2. このタスクリストで次のタスク確認
3. 最後のコミットを確認
4. 作業再開

---

## 🐛 既知のバグ・問題

### バグリスト
1. **冒険者が壁をすり抜ける場合がある**
   - 発生条件: 高速移動時
   - 対処: 衝突判定の改善が必要

2. **罠が連続発動する**
   - 発生条件: クールダウン中も発動
   - 対処: triggered状態の管理改善

3. **セーブデータが大きくなりすぎる**
   - 発生条件: 長時間プレイ
   - 対処: データ圧縮or不要データ削除

### 改善要望
- ダンジョンのビジュアルが単調
- 冒険者の種類が少ない
- エンドコンテンツがない
- チュートリアルがない

---

## 次のアクション
**推奨:** Phase 2のタスク2.1（戦闘システムの完全実装）から着手